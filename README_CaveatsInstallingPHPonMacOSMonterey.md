# Read this in its entirety prior to attempting to install PHP (for usage within AIFCOMSS) on MacOS Monterey (MacOS 12.x.x)

Ridiculously, and infuriatingly (at least in my view): Apple, for whatever reasons, decided to take what is an excellent working PHP installation on all MacOS versions between 10.13 (High Sierra) and 11.x.x (Big Sur), and simply destroy it for MacOS Monterey (12.x.x).  (It appears to me that Apple paid its MacOS software engineers *explicitly to break PHP functionality in MacOS Monterey* -- and Apple also expresses the intention of doing so in future MacOS versions as well!  And they did this thoroughly enough that users must now employ a number of tricks to properly install and enable PHP.)  A lengthy and useful guide to PHP reinstallation in Monterey can be found [here](https://getgrav.org/blog/macos-monterey-apache-multiple-php-versions).  ***However*** .... like most such software installation guides, that guide contains a number of errors, some falsehoods, some misleading statements, some things that seem unnecessary but are actually entirely necessary, some things that seem necessary but are actually entirely unnecessary, and several "10% truths" :

Firstly, per the unfortunate title of that guide: Why on Earth would one ever want *multiple* different PHP installations on one's computer?  The answer to that (certainly at least here) is that one *wouldn't* -- one only needs ***one*** working PHP installation, and one only wants ***one*** working PHP installation, on one's computer.  So, please just ignore the title of that guide -- when you get to the point in the guide (which is, unavoidably, fairly far down) of actually installing PHP itself, then please just install the PHP version 7.4 that it suggests, and please ignore (i.e., don't install) both the older *nor the more recent* PHP versions than 7.4 that are also included in the guide.  You **won't want** the most recent PHP 8.x.  **You only want PHP 7.4**.

Secondly (and from now on, I'll be going in order down from the top of that [page](https://getgrav.org/blog/macos-monterey-apache-multiple-php-versions)), if you're like me and forget/overlook the requirement near the top of that page to set whether you're using an Apple (ARM) CPU (M1 or M2), or (like me) have an Intel CPU-based Mac, you will *very seriously* regret such an overlook...  This is because, for whatever other reasons, Apple decided to use CPU hardware as the deciding factor for whether to put all Homebrew-built software package code into subdirectories of /usr/local/etc/ (which it does for all Intel CPU-based Macs, and as had always been done previously), or else into subdirectories of a new directory named /opt/homebrew/etc/ (which it does for new Apple CPU-based Macs).  (What that particular software directory name choice has to do with CPU hardware -- i.e., ***absolutely nothing*** -- is beyond everyone except Apple software engineering management, who 100% violated the critical principle of when a software change absolutely must be made, then one should bite the bullet and make it universally, and don't tie it to some unrelated criterion such as what type of CPU someone is running on, if the change is completely unrelated to CPU architecture.)  So, just be absolutely sure to choose the position of that switch near the top of that page correctly.

Thirdly: You might believe that you already have XCode Command Line Tools and/or Homebrew installed, because you just upgraded to Monterey from some previous MacOS version, and you had one or both of those installed before you upgraded.  You *don't*.  You will need to start with those sections in the guide exactly like someone who is starting with a fresh new MacOS Monterey computer would: those tools get deprecated every time one upgrades one's MacOS at least a full version, so they need to be completely reinstalled.  So, you must do those sections (like most other things in the guide) verbatim and in their entirety, before attempting anything below them.

Fourthly: I had issues (maybe because I had attempted to install PHP earlier, prior to following this particular guide step-by-step -- but however possibly not, you might encounter this issue too) of the commands "brew services stop httpd", "brew services start httpd", "brew services restart httpd" not working at all, even after stopping apachectl and brew installing httpd **both exactly as destribed in the guide** -- and thus still always needing to do "sudo apachectl restart" every time anything changes in httpd.conf (which btw, very importantly, for Intel CPU-based Macs, will then be located in /usr/local/etc/httpd/httpd.conf, and **not** in either /etc/apache2/httpd.conf, nor in /opt/homebrew/etc/httpd/httpd.conf -- btw, the location will become the third of these for Apple CPU-based Macs after brew installing httpd; and the second of these locations is just the old, pre-httpd-brew-installation location of httpd.conf, which gets neutered and is no longer used at all after brew installation of httpd, even if one is finding that "brew services stop httpd", "brew services start httpd", etc don't do anything and one still always needs to use "sudo apachectl restart" -- the location of the active httpd.conf file in such Intel CPU-based Macs will still at this point be the new /usr/local/etc/httpd/httpd.conf location, and not the old /etc/apache2/httpd.conf location).  So, if one finds that one still needs to use "sudo apachectl restart" rather than "brew services restart httpd", then just do it, or do both, and don't worry as to why.

Fifthly, don't worry at all about the little "Visual Studio Code" mini-section.  I suggest just using nano or pico as your editor (like I do), or vi, or emacs, or whatever editor you like.  You should skip over that "Visual Studio Code" mini-section, and resume right below it at "Apache Configuration" (and, instead of using "code <filename>", use "pico <filename>" or "nano <filename>", etc, in that and future sections).

Sixthly, within the "PHP Installation" section, it is very tempting to studiously ignore the guide's suggestion to use the version of PHP that has some dude's name attached to it (i.e. shivammathur/php) and instead to just use the official php installation (i.e. php).  ***Don't do that***.  The official php installation gave me trouble, whereas shivammathur/php worked well for me.  So, use the shivammathur/php installation just like the guide suggests.  *However*, only do the brew install for the PHP 7.4 installation that it suggests, and not the brew install of the PHP 7.0, 7.1, 7.2, 7.3, or 8.0 versions.  Just 7.4.
  
Seventhly, at the end of the "Validating PHP Installation" section, if things (PHP-wise) do appear to be valid and working for you at that point, then just stop at the end of that section there.  There is no need to (i.e. don't) do the "PHP Switcher Script" section, ***nor anything below that***.  Just stop at the end of "Validating PHP Installation" if things are working for you there.  (But, if things are not working for you there, or you have questions, [e-mail me](mailto:jalbert@uvic.ca) ).

Now that you've hopefully successfully installed PHP on your MacOS Monterey, you should go back to the main AIFCOMSS installation guide (and start again there from the point at which you came here).
